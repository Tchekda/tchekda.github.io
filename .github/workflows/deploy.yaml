name: Build SASS and deploy
on:
    push:
        branches:
            - dev
  
jobs:
    build_css:
        runs-on: ubuntu-latest
        name: Build SASS
        steps:
            - name: Setup Node
              uses: actions/setup-node@v2
              with:
                node-version: 18
            - name: Checkout dev Git branch
              uses: actions/checkout@v2
            - name: Caching
              id: cache-build
              uses: actions/cache@v2
              with:
                path: |
                  node_modules
                  assets/css
                key: ${{ runner.os }}-site-build-${{ github.run_id }}
                restore-keys: |
                  ${{ runner.os }}-site-build-        
            - name: Install dependencies
              run: yarn
            - name: Build CSS
              run: yarn release
            - name: Checkout master Git branch
              uses: actions/checkout@v2
              with:
                ref: master
            - name: Add and Commit changes to master branch
              run: |
                git config --local user.email 'action@github.com'
                git config --local user.name 'GitHub Action'
                git add .
                git add -f assets/css/*
                git commit -m 'Updates compiled CSS files'
            - name: Push changes to master
              uses: ad-m/github-push-action@master
              with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                branch: master
